<section class="oe_container">
  <div class="oe_row oe_spaced">
    <h2 class="oe_slogan">Pricelist Customers Smart Button — Odoo 18</h2>
    <p>
      Ajoute un bouton <strong>Clients</strong> sur les listes de prix pour ouvrir, en un clic,
      les partenaires <em>réellement</em> concernés, en filtrant les contacts enfants et en respectant le multi-sociétés.
    </p>


      <h3>Règles d’affichage</h3>
<ul>
  <li><em>Actifs & clients</em> : uniquement les partenaires <code>active=True</code> avec <code>customer_rank &gt; 0</code>.</li>
  <li><em>Niveau affiché</em> : uniquement les <strong>sociétés</strong> (<code>is_company=True</code>) ou les <strong>contacts racine</strong> (<code>parent_id=False</code>). Les adresses fille (facturation/expédition) ne sont <strong>jamais</strong> listées.</li>
  <li><em>Périmètre LP</em> (priorité Odoo 18)&nbsp;:
    <ul>
      <li>si le champ <code>specific_property_product_pricelist</code> existe : afficher si<br>
        <code>specific_property_product_pricelist = pricelist_id</code> <strong>OU</strong>
        (<code>specific_property_product_pricelist</code> vide <strong>ET</strong> <code>property_product_pricelist = pricelist_id</code>).
      </li>
      <li>sinon : afficher si <code>property_product_pricelist = pricelist_id</code>.</li>
    </ul>
  </li>
  <li><em>Multi-sociétés</em> : la résolution des champs dépendants de société suit <code>allowed_company_ids</code> (contexte injecté depuis la LP).</li>
</ul>

<h3>Boutons ajoutés</h3>
<ul>
  <li><em>Vue formulaire LP</em> : smart button « Clients » (<code>oe_stat_button</code> + <code>statinfo</code>, icône <code>fa-user</code>, compteur <code>customers_count</code>).</li>
  <li><em>Vue liste LP</em> (<code>product.product_pricelist_view_tree</code>) : bouton « Clients » en <strong>fin de ligne</strong>, <code>type="object"</code>, <code>class="btn-link"</code>, <code>icon="fa-user"</code>.</li>
</ul>

<h3>Compatibilité</h3>
<ul>
  <li>Odoo 18 : plus d’<code>ir.property</code> ; les champs dépendants de société sont stockés en JSON et résolus via le contexte de société.</li>
  <li>Types de vue : utiliser <code>list</code> (remplace <code>tree</code>), sinon erreur « View types not defined tree ».</li>
</ul>


  <div class="oe_row oe_spaced">
    <h3 class="oe_slogan">Captures d'écran</h3>

      <h4 class="oe_slogan">Depuis la vue liste</h4>

    <div class="text-center">
      <img class="img img-fluid oe_screenshot rounded shadow-sm"
           src="/pricelist_customers_button/static/description/pricelist_001.png"
           alt="Vue liste Pricelist avec le bouton Clients">
    </div>

      <h4 class="oe_slogan">Depuis la vue formulaire</h4>

      <div class="text-center">
      <img class="img img-fluid oe_screenshot rounded shadow-sm"
           src="/pricelist_customers_button/static/description/pricelist_002.png"
           alt="Vue Form Pricelist avec le bouton Clients">
    </div>
  </div>

</section>
